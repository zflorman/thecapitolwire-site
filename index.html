<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CEV5ME0C6L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CEV5ME0C6L');
  </script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Capitol Wire | Legislative Intelligence</title>
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    /* --- MODERN LIGHT THEME --- */
    :root {
      --bg-main: #ffffff;
      --bg-subtle: #f8fafc; 
      --bg-gradient: radial-gradient(circle at 50% 0%, #eff6ff, #ffffff 60%); 
      
      --card-bg: #ffffff;
      --card-border: 1px solid #e2e8f0;
      --card-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --card-hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);

      --text-main: #0f172a; 
      --text-muted: #64748b; 
      
      --brand-primary: #2563eb; 
      --brand-dark: #1e3a8a;    
      
      --success: #10b981;
      --warning-bg: #fffbeb;
      --warning-text: #92400e;
      --warning-border: #fcd34d;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
    html { scroll-behavior: smooth; }
    
    body { 
        font-family: 'Inter', sans-serif; 
        color: var(--text-main); 
        background: var(--bg-main); 
        background-image: var(--bg-gradient);
        background-attachment: fixed;
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
    }

    .container { max-width: 900px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 2; }

    /* --- NAV --- */
    nav { 
        background: rgba(255, 255, 255, 0.8); 
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        padding: 16px 0; 
        position: sticky; top: 0; z-index: 100;
    }
    .nav-inner { 
        max-width: 1000px; margin: 0 auto; padding: 0 24px; 
        display: flex; justify-content: space-between; align-items: center; 
    }
    .logo { 
        font-family: 'Merriweather', serif; font-weight: 800; font-size: 1.2rem; 
        color: var(--brand-primary); text-decoration: none; display: flex; align-items: center; gap: 8px;
        letter-spacing: -0.5px;
    }
    .nav-links { display: flex; align-items: center; gap: 24px; }
    .nav-link { 
        color: var(--text-muted); text-decoration: none; font-size: 0.9rem; font-weight: 500; 
        transition: color 0.2s; cursor: pointer; 
    }
    .nav-link:hover { color: var(--brand-primary); }
    
    .sub-btn { 
        background: var(--brand-primary); 
        color: white; 
        padding: 8px 16px; 
        border-radius: 6px; 
        font-weight: 600; 
        text-decoration: none; 
        font-size: 0.85rem; 
        transition: transform 0.1s;
    }
    .sub-btn:hover { background: var(--brand-dark); }

    /* --- DROPDOWN --- */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content { 
        display: none; position: absolute; 
        background: white;
        min-width: 200px; 
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        border-radius: 8px; 
        z-index: 100; top: 120%; left: 50%; transform: translateX(-50%); 
        padding: 6px; 
        opacity: 0; transition: opacity 0.2s;
        border: 1px solid #e2e8f0;
    }
    .dropdown:hover .dropdown-content { display: block; opacity: 1; top: 100%; animation: slideUpFade 0.2s ease-out; }
    .dropdown-content a { 
        color: var(--text-main); padding: 8px 12px; text-decoration: none; display: block; 
        font-size: 0.85rem; font-weight: 500; border-radius: 4px; 
    }
    .dropdown-content a:hover { background-color: #eff6ff; color: var(--brand-primary); }

    /* --- HERO SECTION --- */
    /* UPDATED: Removed bottom padding almost entirely */
    .hero { text-align: center; padding: 100px 0 0px; position: relative; }
    
    .hero h1 { 
        font-family: 'Merriweather', serif; 
        font-size: 3.5rem; 
        color: var(--text-main); 
        margin-bottom: 24px; 
        line-height: 1.1;
        letter-spacing: -1px;
    }
    .hero h1 span.highlight {
        color: var(--brand-primary);
        position: relative;
    }
    .hero h1 span.highlight::after {
        content: ''; position: absolute; bottom: 5px; left: 0; width: 100%; height: 6px;
        background: rgba(37, 99, 235, 0.1); z-index: -1; transform: rotate(-1deg);
    }

    /* Typewriter */
    .typing-wrapper { display: inline-block; }
    
    .typing-text {
        display: inline-block;
        font-family: 'Merriweather', serif; 
        font-weight: 700; 
        color: var(--brand-primary);
        border-right: 3px solid var(--text-main);
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        
        /* FIX 1: Restored 'steps(14)' to match the 14 characters in "Weekly Agenda." */
        animation: typing 2.5s steps(14, end) forwards, blink-caret 0.8s step-end infinite;

        /* FIX 2: Added line-height and padding to stop the 'g' from being cut off */
        line-height: 1.3;
        padding-bottom: 5px; 
        vertical-align: bottom; 
    }
    @keyframes typing { to { width: 100%; } }
    @keyframes blink-caret { 50% { border-color: transparent; } }

    /* Checklist */
    .hero-checklist {
        display: inline-block; text-align: left;
        color: var(--text-muted);
        font-size: 1.1rem; line-height: 1.8;
        margin: 0 auto 40px; max-width: 680px;
    }
    .check { color: var(--success); margin-right: 12px; font-weight: bold; }
    .hero-checklist strong { color: var(--text-main); font-weight: 600; }
    
    .hero-checklist a {
        color: var(--brand-primary);
        text-decoration: none;
        border-bottom: 1px dotted var(--brand-primary);
        font-weight: 600;
        transition: all 0.2s;
    }
    .hero-checklist a:hover { color: var(--brand-dark); border-bottom-style: solid; }

    /* --- FORM (UPDATED) --- */
    .form-wrapper { 
        max-width: 480px; margin: 0 auto; display: flex; gap: 10px; 
        padding: 4px;
        position: relative;
        z-index: 10;
    }
    input { 
        flex: 1; padding: 16px 20px; 
        border: 1px solid #cbd5e1; 
        background: white; 
        color: var(--text-main);
        border-radius: 8px; font-size: 1rem; 
        transition: all 0.2s; 
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    input::placeholder { color: #94a3b8; }
    input:focus { border-color: var(--brand-primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    
    /* UPDATED: Super "Pop" Button */
    button.form-btn { 
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        color: white; border: none; 
        padding: 16px 28px; border-radius: 8px; 
        font-weight: 700; cursor: pointer; 
        font-size: 1rem;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2), 0 2px 4px -1px rgba(37, 99, 235, 0.1);
    }
    button.form-btn:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3), 0 4px 6px -2px rgba(37, 99, 235, 0.1);
    }
    button.form-btn:disabled { opacity: 0.7; cursor: wait; }
    
    /* Reduced margin for the message area */
    .msg { margin-top: 5px; font-size: 0.9rem; min-height: 24px; font-weight: 500; } 

    /* --- FEED WRAPPER --- */
    .feed-wrapper { padding: 0 0 80px; }

    /* Status Bar (UPDATED Spacing) */
    .status-bar {
        display: flex; align-items: center; gap: 12px;
        font-size: 0.85rem; color: var(--text-muted); font-weight: 500;
        background: white; padding: 8px 16px; border-radius: 100px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        margin-bottom: 30px;
        width: fit-content;
        margin-left: auto; margin-right: auto; 
        
        /* UPDATED: Very tight top margin */
        margin-top: 10px; 
    }
    
    .live-dot { 
        width: 8px; height: 8px; 
        background: #22c55e; 
        border-radius: 50%; 
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        animation: ripple 1.5s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }
    @keyframes ripple {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    /* Feed Sections */
    .feed-section { 
        background: var(--card-bg); 
        border: var(--card-border); 
        border-radius: 12px; 
        box-shadow: var(--card-shadow); 
        margin-bottom: 30px; overflow: hidden; 
        opacity: 0; transform: translateY(20px);
        transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .feed-section:hover { box-shadow: var(--card-hover-shadow); }
    .feed-section.visible { opacity: 1; transform: translateY(0); }

    .section-header {
        background: #f8fafc;
        padding: 14px 20px;
        font-family: 'Inter', sans-serif;
        font-weight: 700; font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase; letter-spacing: 0.5px;
        border-bottom: 1px solid #e2e8f0;
        display: flex; align-items: center; gap: 8px;
    }
    
    .bill-item { 
        padding: 18px 20px; 
        border-bottom: 1px solid #f1f5f9; 
        display: flex; flex-direction: column; gap: 6px; 
        transition: background 0.1s; 
    }
    .bill-item:last-child { border-bottom: none; }
    .bill-item:hover { background: #f8fafc; }
    
    .bill-row { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; }
    
    .bill-title { 
        color: var(--text-main); font-size: 1rem; line-height: 1.5; flex: 1; font-weight: 400; 
    }
    .bill-title strong { 
        font-weight: 700; color: var(--text-main); 
        font-family: 'Merriweather', serif;
    }
    
    .bill-links { display: flex; gap: 8px; }
    .doc-link { 
        color: var(--brand-primary); text-decoration: none; 
        background: #eff6ff; padding: 3px 8px; border-radius: 4px; 
        font-size: 0.75rem; font-weight: 600; 
        transition: all 0.2s;
    }
    .doc-link:hover { background: var(--brand-primary); color: white; }
    
    .bill-meta { 
        font-size: 0.8rem; color: var(--text-muted); 
        display: flex; align-items: center; gap: 8px; margin-top: 4px; 
    }
    .meta-time { 
        color: #be123c; font-weight: 600; background: #fff1f2; 
        padding: 1px 6px; border-radius: 4px; font-size: 0.75rem;
    }

    footer { 
        padding: 60px 0; text-align: center; color: #94a3b8; font-size: 0.9rem; 
        border-top: 1px solid #e2e8f0; margin-top: 60px;
    }
    footer a { color: #64748b; text-decoration: none; transition: color 0.2s; }
    footer a:hover { color: var(--brand-primary); text-decoration: underline; }
    .footer-links { margin-top: 20px; display: flex; justify-content: center; gap: 24px; }

    @media (max-width: 768px) { 
        .hero h1 { font-size: 2.2rem; }
        .form-wrapper { flex-direction: column; padding: 0; }
        input { width: 100%; margin-bottom: 10px; }
        button.form-btn { width: 100%; }
        .nav-inner { flex-direction: column; gap: 15px; }
        .bill-row { flex-direction: column; gap: 10px; }
        .hero-checklist { padding-left: 10px; font-size: 1rem; }
    }
    
    @keyframes slideUpFade { from { opacity: 0; transform: translate(-50%, 10px); } to { opacity: 1; transform: translate(-50%, 0); } }
  </style>
</head>
<body>

  <nav>
    <div class="nav-inner">
      <a href="/" class="logo">üèõÔ∏è The Capitol Wire</a>
      <div class="nav-links">
        
        <div class="dropdown">
          <a href="#live-feed" class="nav-link">Live Feed ‚ñæ</a>
          <div class="dropdown-content">
            <a href="#latest-container">‚ö° Latest Activity</a>
            <a href="#cat-suspension">Suspensions</a>
            <a href="#cat-rule">Rules</a>
            <a href="#cat-possible-consideration">Possible Consideration</a>
          </div>
        </div>

        <a href="dashboard/" class="nav-link">Dashboard</a>
        <a href="#hero" class="sub-btn">Get Alerts</a>
      </div>
    </div>
  </nav>

  <section id="hero" class="hero">
    <div class="container">
      <h1>
        Real-Time Alerts for the<br>
        <span class="highlight">House Floor</span> 
        <span class="typing-wrapper"><span class="typing-text">Weekly Agenda.</span></span>
      </h1>
      
      <div class="hero-checklist">
        <div>
          <span class="check">‚úì</span> Monitors 
          <a href="https://docs.house.gov/floor/" target="_blank">Docs.House.Gov/floor</a> 
          and 
          <a href="https://www.majorityleader.gov/schedule/weekly-schedule.htm" target="_blank">MajorityLeader.gov</a> 
          every 60 seconds.
        </div>
        <div><span class="check">‚úì</span> Auto-detects <strong>Advance Notices</strong> (items not yet filed with the Clerk).</div>
        <div><span class="check">‚úì</span> <strong>Instant email alerts</strong> directly to you for free.</div>
      </div>
      
      <div class="form-wrapper">
        <input type="email" id="email" placeholder="Enter your email" required />
        <button id="submitBtn" class="form-btn">Subscribe for Free</button>
      </div>
      <div id="status" class="msg"></div>
    </div>
  </section>

  <div id="live-feed" class="feed-wrapper">
    <div class="container">
        
      <div class="status-bar">
          <div class="live-dot"></div>
          <div id="status-line">System Online. Monitoring active feeds...</div>
      </div>

      <div id="latest-container" class="feed-section" style="display:none; border-color: var(--warning-border);">
          <div class="section-header" style="background: var(--warning-bg); color: var(--warning-text); border-bottom-color: var(--warning-border);">
             ‚ö° Latest Activity (New)
          </div>
          <div id="latest-list"></div>
      </div>

      <div id="schedule-list">
          <div style="padding:60px; text-align:center; color: #94a3b8; font-weight:300;">
            Initializing secure connection to Clerk...
          </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div>¬© 2026 The Capitol Wire. Intelligence sourced directly from <a href="https://docs.house.gov/floor/" target="_blank">docs.house.gov/floor</a>.</div>
      <div class="footer-links">
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Service</a>
        <a href="mailto:zach@thecapitolwire.com">Contact Support</a>
      </div>
    </div>
  </footer>

  <script>
    const SUPABASE_URL = "https://jcrsdyyqrbtxyzhveszx.supabase.co";
    const SUPABASE_KEY = "sb_publishable_oQOSOkFpJAPfmnINrAYYUg_FNMRBM1h"; 
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const CATEGORIES = [
        { key: 'Suspension', label: 'Suspension of the Rules' },
        { key: 'Rule', label: 'Pursuant to a Rule' },
        { key: 'Possible Consideration', label: 'Possible Consideration' }
    ];

    let lastKnownTimestamp = "";

    const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
    const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                obs.unobserve(entry.target);
            }
        });
    }, observerOptions);

    async function initFeed() {
        const latestContainer = document.getElementById('latest-container');
        const latestList = document.getElementById('latest-list');
        const scheduleList = document.getElementById('schedule-list');
        const statusLine = document.getElementById('status-line');

        try {
            const { data, error } = await _supabase.from('live_feed').select('*').order('id', { ascending: true });

            if (data && data.length > 0) {
                const newestTimestamp = data[0].timestamp;
                
                if (newestTimestamp !== lastKnownTimestamp) {
                    lastKnownTimestamp = newestTimestamp;

                    scheduleList.innerHTML = '';
                    latestList.innerHTML = '';
                    
                    if (newestTimestamp && newestTimestamp.trim() !== "") {
                        statusLine.innerHTML = "Last confirmed update: <b>" + newestTimestamp + "</b>";
                    }

                    let hasLatest = false;
                    if (newestTimestamp && newestTimestamp.trim() !== "") {
                        data.forEach(item => {
                            if (item.timestamp === newestTimestamp) {
                                latestList.appendChild(createBillItem(item));
                                hasLatest = true;
                            }
                        });
                    }
                    latestContainer.style.display = hasLatest ? 'block' : 'none';
                    if(hasLatest) observer.observe(latestContainer);

                    CATEGORIES.forEach(cat => {
                        const catItems = data.filter(i => i.category === cat.key);
                        if (catItems.length > 0) {
                            const section = document.createElement('div');
                            section.className = 'feed-section';
                            
                            const header = document.createElement('div');
                            header.className = 'section-header';
                            let icon = "üìÑ";
                            if(cat.key === 'Suspension') icon = "üöÄ";
                            if(cat.key === 'Rule') icon = "‚öñÔ∏è";
                            if(cat.key === 'Possible Consideration') icon = "üëÄ";
                            
                            header.innerHTML = `${icon} &nbsp; ${cat.label}`;
                            section.appendChild(header);
                            
                            catItems.forEach(item => section.appendChild(createBillItem(item)));
                            scheduleList.appendChild(section);
                            
                            observer.observe(section);
                        }
                    });
                }
            } else {
                scheduleList.innerHTML = '<div style="padding:60px; text-align:center; color:#94a3b8;">No Active Schedule Data Found.</div>';
            }
        } catch (e) { console.error(e); }
    }

    function createBillItem(item) {
        const div = document.createElement('div');
        div.className = 'bill-item';
        
        let linkHtml = '';
        if (item.link) {
            const isPdf = item.link.toLowerCase().endsWith('pdf');
            linkHtml = `<div class="bill-links"><a href="${item.link}" target="_blank" class="doc-link">${isPdf ? 'PDF' : 'TEXT'}</a></div>`;
        }
        
        let timeHtml = '';
        if (item.timestamp && item.timestamp.trim() !== "") {
            timeHtml = `<div class="bill-meta">Updated: <span class="meta-time">${item.timestamp}</span></div>`;
        }

        let fullTitle = item.title;
        let boldPart = fullTitle;
        let normalPart = "";

        let splitIndex = fullTitle.indexOf("‚Äî");
        if (splitIndex === -1) splitIndex = fullTitle.indexOf("-");

        if (splitIndex !== -1) {
            boldPart = fullTitle.substring(0, splitIndex).trim(); 
            normalPart = fullTitle.substring(splitIndex); 
        } else {
            boldPart = fullTitle;
        }

        div.innerHTML = `
            <div class="bill-row">
                <div class="bill-title"><strong>${boldPart}</strong> ${normalPart}</div>
                ${linkHtml}
            </div>
            ${timeHtml}
        `;
        return div;
    }
    
    initFeed();
    setInterval(initFeed, 10000);

    const btn = document.getElementById('submitBtn');
    const input = document.getElementById('email');
    const stat = document.getElementById('status');

    btn.addEventListener('click', async () => {
      const email = input.value.trim();
      
      if (!email.includes('@')) { 
          stat.textContent = "Please enter a valid email."; 
          stat.style.color = "#dc2626"; 
          return; 
      }

      btn.disabled = true; 
      btn.textContent = "Authenticating...";
      stat.textContent = "";

      const { error } = await _supabase.from('subscribers').insert([{ email: email }]);

      if (error) {
          if (error.code === '23505') {
              stat.textContent = "You are already in the system.";
              stat.style.color = "#2563eb"; 
          } else {
              stat.textContent = "Connection error. Please retry.";
              stat.style.color = "#dc2626"; 
          }
          btn.disabled = false; 
          btn.textContent = "Subscribe for Free";
      } else {
          stat.textContent = "Confirmed. You are now tracking the floor.";
          stat.style.color = "#16a34a"; // Green
          input.value = "";
          btn.textContent = "Success";
          
          setTimeout(() => {
              btn.disabled = false;
              btn.textContent = "Subscribe Colleague";
              stat.textContent = "";
          }, 3000);
      }
    });
  </script>
</body>
</html>
