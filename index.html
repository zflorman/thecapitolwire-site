<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Capitol Wire | Real-Time Legislative Tracker</title>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Merriweather:wght@700;900&display=swap" rel="stylesheet">

  <style>
    /* --- CSS RESET --- */
    :root {
      --primary: #0f172a;
      --accent: #2563eb;
      --bg: #ffffff;
      --bg-alt: #f8fafc;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; color: var(--text); background: var(--bg); line-height: 1.5; }
    a { text-decoration: none; color: inherit; transition: color 0.2s; }

    /* --- NAV --- */
    nav { border-bottom: 1px solid var(--border); padding: 16px 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); position: sticky; top:0; z-index: 100; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
    .nav-inner { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-family: 'Merriweather', serif; font-weight: 900; font-size: 1.3rem; color: var(--primary); letter-spacing: -0.5px; }
    .logo span { color: var(--accent); }
    .nav-btn { background: var(--primary); color: white; padding: 8px 20px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; }
    .nav-btn:hover { background: #334155; }

    /* --- HERO --- */
    .hero { text-align: center; padding: 80px 0 60px; }
    .hero h1 { font-family: 'Merriweather', serif; font-size: 3rem; margin-bottom: 20px; line-height: 1.2; color: var(--primary); }
    .hero p { color: var(--text-muted); font-size: 1.2rem; max-width: 700px; margin: 0 auto 40px; }

    /* --- LIVE FEED --- */
    .feed-section { background: var(--bg-alt); padding: 60px 0; min-height: 500px; border-top: 1px solid var(--border); }
    
    .feed-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border); }
    .feed-title { display: flex; align-items: center; gap: 10px; font-size: 1.1rem; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }
    .live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; box-shadow: 0 0 0 3px rgba(34,197,94,0.2); animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    
    .status-badge { font-size: 0.8rem; font-weight: 600; color: #059669; background: #d1fae5; padding: 4px 10px; border-radius: 20px; }

    .feed-grid { display: flex; flex-direction: column; gap: 12px; }
    
    .bill-row { 
      background: white; 
      border: 1px solid var(--border); 
      border-radius: 8px; 
      padding: 20px 24px; 
      display: grid; 
      grid-template-columns: 80px 1fr 180px; 
      gap: 24px; 
      align-items: center;
      transition: all 0.2s;
    }
    .bill-row:hover { border-color: var(--accent); transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }

    .bill-category { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: var(--text-muted); background: #f1f5f9; padding: 4px 8px; border-radius: 4px; text-align: center; }
    .bill-title { font-weight: 600; font-size: 1.05rem; color: var(--primary); line-height: 1.4; }
    .bill-meta { text-align: right; }
    .timestamp { display: block; font-size: 0.85rem; color: #dc2626; font-weight: 500; margin-bottom: 4px; }
    .doc-link { font-size: 0.8rem; color: var(--accent); font-weight: 600; }
    .doc-link:hover { text-decoration: underline; }

    /* --- EMAIL FORM --- */
    .form-wrapper { max-width: 500px; margin: 0 auto; position: relative; }
    .input-group { display: flex; gap: 8px; background: white; padding: 6px; border: 1px solid #cbd5e1; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    input { flex: 1; border: none; padding: 10px 15px; font-size: 1rem; outline: none; }
    button { background: var(--accent); color: white; border: none; padding: 10px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1d4ed8; }
    .msg { margin-top: 10px; font-size: 0.9rem; text-align: center; min-height: 24px; }

    /* --- FOOTER --- */
    footer { padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--border); margin-top: auto; }

    @media (max-width: 768px) {
      .bill-row { grid-template-columns: 1fr; gap: 10px; padding: 15px; }
      .bill-meta { text-align: left; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f1f5f9; padding-top: 10px; margin-top: 5px; }
      .bill-category { display: inline-block; width: auto; margin-bottom: 5px; }
    }
  </style>
</head>
<body>

  <nav>
    <div class="container nav-inner">
      <div class="logo">üèõÔ∏è The Capitol <span>Wire</span></div>
      <a href="#subscribe" class="nav-btn">Get Alerts</a>
    </div>
  </nav>

  <header class="hero">
    <div class="container">
      <h1>Track Legislation Instantly.</h1>
      <p>Direct feed from the House Clerk's server. <br>We monitor official schedule changes 24/7 so you don't have to.</p>
      
      <div id="subscribe" class="form-wrapper">
        <div class="input-group">
          <input type="email" id="email" placeholder="Enter work email..." required />
          <button id="submitBtn">Subscribe Free</button>
        </div>
        <div id="status" class="msg"></div>
      </div>
    </div>
  </header>

  <section class="feed-section">
    <div class="container">
      <div class="feed-header">
        <div class="feed-title"><div class="live-dot"></div> Live House Feed</div>
        <div class="status-badge">System Operational</div>
      </div>

      <div id="live-feed-container" class="feed-grid">
        <div style="text-align:center; padding: 60px; color:#94a3b8;">
          Loading official schedule...
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      &copy; 2025 The Capitol Wire. Data sourced directly from docs.house.gov.
    </div>
  </footer>

  <script>
    const SUPABASE_URL = "https://jcrsdyyqrbtxyzhveszx.supabase.co";
    const SUPABASE_KEY = "sb_publishable_oQOSOkFpJAPfmnINrAYYUg_FNMRBM1h"; 
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function initLiveFeed() {
        const container = document.getElementById('live-feed-container');
        try {
            // Fetch live data from Supabase
            const { data, error } = await _supabase
                .from('live_feed')
                .select('*')
                .order('id', { ascending: true });

            if (data && data.length > 0) {
                container.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'bill-row';
                    
                    // Determine Link Text
                    const isPdf = item.link.toLowerCase().endsWith('pdf');
                    const linkText = isPdf ? 'Download PDF' : 'View Text';

                    row.innerHTML = `
                        <div class="bill-category">${item.category}</div>
                        <div class="bill-title">${item.title}</div>
                        <div class="bill-meta">
                            <span class="timestamp">${item.timestamp}</span>
                            <a href="${item.link}" target="_blank" class="doc-link">${linkText} &rarr;</a>
                        </div>
                    `;
                    container.appendChild(row);
                });
            } else {
                container.innerHTML = '<div style="text-align:center; padding:60px; color:#64748b;">No active legislation scheduled at this moment.</div>';
            }
        } catch (e) {
            console.error(e);
            container.innerHTML = '<div style="text-align:center; padding:60px; color:#dc2626;">Unable to load live feed. Please refresh.</div>';
        }
    }
    
    // Initialize Feed
    initLiveFeed();

    // Subscription Logic
    const emailInput = document.getElementById('email');
    const submitBtn = document.getElementById('submitBtn');
    const statusDiv = document.getElementById('status');

    submitBtn.addEventListener('click', async () => {
      const email = emailInput.value.trim();
      if (!email || !email.includes('@')) {
        statusDiv.textContent = "Please enter a valid email address.";
        statusDiv.style.color = "#dc2626";
        return;
      }
      submitBtn.disabled = true;
      submitBtn.textContent = "Processing...";
      
      const { error } = await _supabase.from('subscribers').insert([{ email: email }]);
      
      if (error) {
          if (error.code === '23505') {
             statusDiv.textContent = "You are already on the list!";
             statusDiv.style.color = "#059669";
          } else {
             statusDiv.textContent = "Error joining list. Please try again.";
             statusDiv.style.color = "#dc2626";
          }
      } else {
          statusDiv.textContent = "Success! You are now subscribed.";
          statusDiv.style.color = "#059669";
          emailInput.value = "";
      }
      
      setTimeout(() => { submitBtn.disabled = false; submitBtn.textContent = "Subscribe Free"; }, 3000);
    });
  </script>
</body>
</html>
