<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CEV5ME0C6L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CEV5ME0C6L');
  </script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Capitol Wire | Legislative Intelligence</title>
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    /* --- FORTUNE 500 VARIABLES --- */
    :root {
      /* Deep Enterprise Palette */
      --bg-dark: #020617;      /* Almost black */
      --bg-gradient: radial-gradient(circle at 50% 0%, #1e1b4b, #020617 80%);
      
      --card-bg: rgba(255, 255, 255, 0.98);
      --card-border: 1px solid rgba(226, 232, 240, 0.8);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --card-hover-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

      --text-main: #0f172a;
      --text-muted: #64748b;
      
      --brand-primary: #3b82f6; /* Electric Blue */
      --brand-accent: #6366f1;  /* Indigo */
      --brand-gradient: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      
      --success: #10b981;
      --warning-bg: #fffbeb;
      --warning-text: #92400e;
      --warning-border: #fcd34d;
    }

    /* RESET & BASE */
    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
    html { scroll-behavior: smooth; }
    
    body { 
        font-family: 'Inter', sans-serif; 
        color: var(--text-main); 
        background: var(--bg-dark); 
        background-image: var(--bg-gradient);
        background-attachment: fixed;
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
    }

    .container { max-width: 1000px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 2; }

    /* --- GLASS NAV --- */
    nav { 
        background: rgba(15, 23, 42, 0.6); /* Semi-transparent dark */
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding: 18px 0; 
        position: sticky; top: 0; z-index: 100;
        transition: all 0.3s ease;
    }
    .nav-inner { 
        max-width: 1200px; margin: 0 auto; padding: 0 24px; 
        display: flex; justify-content: space-between; align-items: center; 
    }
    .logo { 
        font-family: 'Merriweather', serif; font-weight: 900; font-size: 1.25rem; 
        color: white; text-decoration: none; display: flex; align-items: center; gap: 10px;
        letter-spacing: -0.02em;
    }
    .nav-links { display: flex; align-items: center; gap: 30px; }
    .nav-link { 
        color: #94a3b8; text-decoration: none; font-size: 0.9rem; font-weight: 500; 
        transition: color 0.2s; cursor: pointer; 
    }
    .nav-link:hover { color: white; }
    
    /* Premium Button */
    .sub-btn { 
        background: white; 
        color: var(--bg-dark); 
        padding: 8px 16px; 
        border-radius: 6px; 
        font-weight: 600; 
        text-decoration: none; 
        font-size: 0.85rem; 
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .sub-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(255,255,255,0.2); }

    /* --- DROPDOWN (Modernized) --- */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content { 
        display: none; position: absolute; 
        background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
        min-width: 220px; 
        box-shadow: 0 20px 40px rgba(0,0,0,0.2); 
        border-radius: 12px; 
        z-index: 100; top: 120%; left: 50%; transform: translateX(-50%); 
        padding: 8px; 
        opacity: 0; transition: opacity 0.2s;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .dropdown:hover .dropdown-content { display: block; opacity: 1; top: 100%; animation: slideUpFade 0.2s ease-out; }
    .dropdown-content a { 
        color: var(--text-main); padding: 10px 12px; text-decoration: none; display: block; 
        font-size: 0.85rem; font-weight: 500; border-radius: 6px; 
    }
    .dropdown-content a:hover { background-color: #f1f5f9; color: var(--brand-primary); }

    /* --- HERO SECTION --- */
    .hero { text-align: center; padding: 80px 0 60px; position: relative; }
    
    /* Background Glow Effect behind Hero */
    .hero::before {
        content: ''; position: absolute; top: -50%; left: 50%; transform: translateX(-50%);
        width: 800px; height: 800px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, rgba(0,0,0,0) 70%);
        z-index: -1; pointer-events: none;
    }

    .hero h1 { 
        font-family: 'Merriweather', serif; 
        font-size: 3.5rem; 
        color: white; 
        margin-bottom: 24px; 
        line-height: 1.1;
        letter-spacing: -1px;
    }
    .hero h1 span.highlight {
        background: var(--brand-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 900;
    }

    /* Typewriter Style Update */
    .typing-wrapper { display: inline-block; }
    .typing-text {
        font-family: 'Inter', sans-serif; /* Modern sans for the dynamic part */
        font-style: normal;
        font-weight: 600;
        color: #93c5fd; /* Light Blue */
        border-right: 3px solid #6366f1;
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        animation: typing 2.5s steps(14, end) forwards, blink-caret 0.8s step-end infinite;
    }
    @keyframes typing { to { width: 100%; } }
    @keyframes blink-caret { 50% { border-color: transparent; } }

    /* --- MODERN CHECKLIST --- */
    .hero-checklist {
        display: inline-block; text-align: left;
        color: #cbd5e1; /* Light grey text on dark bg */
        font-size: 1.15rem; line-height: 1.8;
        margin: 0 auto 40px; max-width: 700px;
        font-weight: 300;
    }
    .check { color: var(--success); margin-right: 12px; font-weight: bold; }
    .hero-checklist strong { color: white; font-weight: 600; }
    .hero-checklist a {
        color: #93c5fd;
        text-decoration: none;
        border-bottom: 1px dotted #93c5fd;
        transition: all 0.2s;
    }
    .hero-checklist a:hover { color: white; border-bottom-style: solid; }

    /* --- INPUT FORM (Stripe Style) --- */
    .form-wrapper { 
        max-width: 480px; margin: 0 auto; display: flex; gap: 10px; 
        background: rgba(255,255,255,0.05); padding: 6px; border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.1);
        backdrop-filter: blur(5px);
    }
    input { 
        flex: 1; padding: 14px 18px; 
        border: 1px solid transparent; 
        background: rgba(0,0,0,0.3); 
        color: white;
        border-radius: 8px; font-size: 1rem; 
        transition: all 0.2s; 
    }
    input::placeholder { color: #64748b; }
    input:focus { background: rgba(0,0,0,0.5); border-color: var(--brand-primary); }
    
    button.form-btn { 
        background: var(--brand-gradient); 
        color: white; border: none; 
        padding: 14px 28px; border-radius: 8px; 
        font-weight: 600; cursor: pointer; 
        transition: all 0.2s; 
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }
    button.form-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6); }
    button.form-btn:disabled { opacity: 0.7; cursor: wait; }
    .msg { margin-top: 12px; font-size: 0.9rem; min-height: 24px; font-weight: 500; } 

    /* --- FEED WRAPPER (The Dashboard) --- */
    .feed-wrapper { padding: 40px 0 80px; }

    /* Status Bar */
    .status-bar {
        display: flex; align-items: center; gap: 12px;
        font-size: 0.85rem; color: var(--text-muted); font-weight: 500;
        background: white; padding: 12px 20px; border-radius: 100px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border: 1px solid rgba(255,255,255,0.5);
        margin-bottom: 30px;
        width: fit-content;
        /* Center on mobile, left on desktop usually, but let's center for symmetry */
        margin-left: auto; margin-right: auto; 
    }
    
    .live-dot { 
        width: 8px; height: 8px; background: var(--success); border-radius: 50%; 
        position: relative;
    }
    .live-dot::after {
        content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 100%; height: 100%; border-radius: 50%; border: 1px solid var(--success);
        animation: radar 2s infinite; opacity: 0;
    }
    @keyframes radar { 0% { width: 100%; height: 100%; opacity: 0.8; } 100% { width: 300%; height: 300%; opacity: 0; } }

    /* Feed Sections */
    .feed-section { 
        background: var(--card-bg); 
        border: var(--card-border); 
        border-radius: 16px; 
        box-shadow: var(--card-shadow); 
        margin-bottom: 30px; overflow: hidden; 
        opacity: 0; transform: translateY(30px);
        transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .feed-section.visible { opacity: 1; transform: translateY(0); }

    .section-header {
        background: #f8fafc;
        padding: 16px 24px;
        font-family: 'Inter', sans-serif;
        font-weight: 700; font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase; letter-spacing: 1px;
        border-bottom: 1px solid #e2e8f0;
        display: flex; align-items: center; gap: 8px;
    }
    
    /* Bill Items (The "Cards" inside the list) */
    .bill-item { 
        padding: 20px 24px; 
        border-bottom: 1px solid #f1f5f9; 
        display: flex; flex-direction: column; gap: 8px; 
        transition: background 0.2s; 
        position: relative;
    }
    .bill-item:last-child { border-bottom: none; }
    .bill-item:hover { background: #f8fafc; }
    
    .bill-row { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; }
    
    .bill-title { 
        color: var(--text-main); font-size: 1.05rem; line-height: 1.5; flex: 1; font-weight: 400; 
    }
    .bill-title strong { 
        font-weight: 700; color: #1e293b; 
        font-family: 'Merriweather', serif; /* Serif for bill numbers looks authoritative */
    }
    
    .bill-links { display: flex; gap: 8px; }
    .doc-link { 
        color: var(--brand-primary); text-decoration: none; 
        background: #eff6ff; padding: 4px 10px; border-radius: 6px; 
        font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;
        transition: all 0.2s;
    }
    .doc-link:hover { background: var(--brand-primary); color: white; }
    
    .bill-meta { 
        font-size: 0.8rem; color: var(--text-muted); 
        display: flex; align-items: center; gap: 8px; margin-top: 4px; 
    }
    .meta-time { 
        color: #be123c; font-weight: 700; background: #fff1f2; 
        padding: 2px 8px; border-radius: 99px; font-size: 0.75rem;
    }

    /* FOOTER */
    footer { 
        padding: 60px 0; text-align: center; color: #64748b; font-size: 0.9rem; 
        border-top: 1px solid rgba(255,255,255,0.1); margin-top: 60px;
    }
    footer a { color: #94a3b8; text-decoration: none; transition: color 0.2s; }
    footer a:hover { color: white; }
    .footer-links { margin-top: 20px; display: flex; justify-content: center; gap: 24px; }

    /* MOBILE ADJUSTMENTS */
    @media (max-width: 768px) { 
        .hero h1 { font-size: 2.2rem; }
        .form-wrapper { flex-direction: column; padding: 10px; background: transparent; border: none; }
        input { width: 100%; margin-bottom: 10px; background: rgba(255,255,255,0.1); }
        button.form-btn { width: 100%; }
        .nav-inner { flex-direction: column; gap: 15px; }
        .bill-row { flex-direction: column; gap: 10px; }
    }
    
    /* Animation for Dropdown Slide */
    @keyframes slideUpFade { from { opacity: 0; transform: translate(-50%, 10px); } to { opacity: 1; transform: translate(-50%, 0); } }
  </style>
</head>
<body>

  <nav>
    <div class="nav-inner">
      <a href="/" class="logo">üèõÔ∏è The Capitol Wire</a>
      <div class="nav-links">
        
        <div class="dropdown">
          <a href="#live-feed" class="nav-link">Live Feed ‚ñæ</a>
          <div class="dropdown-content">
            <a href="#latest-container">‚ö° Latest Activity</a>
            <a href="#cat-suspension">Suspensions</a>
            <a href="#cat-rule">Rules</a>
            <a href="#cat-possible-consideration">Possible Consideration</a>
          </div>
        </div>

        <a href="dashboard/" class="nav-link">Dashboard</a>
        <a href="#hero" class="sub-btn">Get Alerts</a>
      </div>
    </div>
  </nav>

  <section id="hero" class="hero">
    <div class="container">
      <h1>
        Real-Time Alerts for the<br>
        <span class="highlight">House Floor</span> 
        <span class="typing-wrapper"><span class="typing-text">Weekly Agenda.</span></span>
      </h1>
      
      <div class="hero-checklist">
        <div>
          <span class="check">‚úì</span> Monitors 
          <a href="https://docs.house.gov/floor/" target="_blank">Docs.House.Gov/floor</a> 
          and 
          <a href="https://www.majorityleader.gov/schedule/weekly-schedule.htm" target="_blank">MajorityLeader.gov</a> 
          every 60 seconds.
        </div>
        <div><span class="check">‚úì</span> Auto-detects <strong>Advance Notices</strong> (items not yet filed with the Clerk).</div>
        <div><span class="check">‚úì</span> <strong>Instant email alerts</strong> directly to you for free.</div>
      </div>
      
      <div class="form-wrapper">
        <input type="email" id="email" placeholder="Enter your work email..." required />
        <button id="submitBtn" class="form-btn">Subscribe for Free</button>
      </div>
      <div id="status" class="msg"></div>
    </div>
  </section>

  <div id="live-feed" class="feed-wrapper">
    <div class="container">
        
      <div class="status-bar">
          <div class="live-dot"></div>
          <div id="status-line">System Online. Monitoring active feeds...</div>
      </div>

      <div id="latest-container" class="feed-section" style="display:none; border-color: var(--warning-border);">
          <div class="section-header" style="background: var(--warning-bg); color: var(--warning-text); border-bottom-color: var(--warning-border);">
             ‚ö° Latest Activity (New)
          </div>
          <div id="latest-list"></div>
      </div>

      <div id="schedule-list">
          <div style="padding:60px; text-align:center; color: #94a3b8; font-weight:300;">
            Initializing secure connection to Clerk...
          </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div>¬© 2026 The Capitol Wire. Intelligence sourced directly from <a href="https://docs.house.gov/floor/" target="_blank">docs.house.gov/floor</a>.</div>
      <div class="footer-links">
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Service</a>
        <a href="mailto:zach@thecapitolwire.com">Contact Support</a>
      </div>
    </div>
  </footer>

  <script>
    const SUPABASE_URL = "https://jcrsdyyqrbtxyzhveszx.supabase.co";
    const SUPABASE_KEY = "sb_publishable_oQOSOkFpJAPfmnINrAYYUg_FNMRBM1h"; 
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const CATEGORIES = [
        { key: 'Suspension', label: 'Suspension of the Rules' },
        { key: 'Rule', label: 'Pursuant to a Rule' },
        { key: 'Possible Consideration', label: 'Possible Consideration' }
    ];

    let lastKnownTimestamp = "";

    // --- SCROLL REVEAL LOGIC ---
    const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
    const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                obs.unobserve(entry.target);
            }
        });
    }, observerOptions);

    async function initFeed() {
        const latestContainer = document.getElementById('latest-container');
        const latestList = document.getElementById('latest-list');
        const scheduleList = document.getElementById('schedule-list');
        const statusLine = document.getElementById('status-line');

        try {
            const { data, error } = await _supabase.from('live_feed').select('*').order('id', { ascending: true });

            if (data && data.length > 0) {
                const newestTimestamp = data[0].timestamp;
                
                if (newestTimestamp !== lastKnownTimestamp) {
                    lastKnownTimestamp = newestTimestamp;

                    scheduleList.innerHTML = '';
                    latestList.innerHTML = '';
                    
                    if (newestTimestamp && newestTimestamp.trim() !== "") {
                        statusLine.innerHTML = "Last confirmed update: <b>" + newestTimestamp + "</b>";
                    }

                    let hasLatest = false;
                    if (newestTimestamp && newestTimestamp.trim() !== "") {
                        data.forEach(item => {
                            if (item.timestamp === newestTimestamp) {
                                latestList.appendChild(createBillItem(item));
                                hasLatest = true;
                            }
                        });
                    }
                    latestContainer.style.display = hasLatest ? 'block' : 'none';
                    if(hasLatest) observer.observe(latestContainer);

                    CATEGORIES.forEach(cat => {
                        const catItems = data.filter(i => i.category === cat.key);
                        if (catItems.length > 0) {
                            const section = document.createElement('div');
                            section.className = 'feed-section';
                            
                            const header = document.createElement('div');
                            header.className = 'section-header';
                            // Add icon based on category
                            let icon = "üìÑ";
                            if(cat.key === 'Suspension') icon = "üöÄ";
                            if(cat.key === 'Rule') icon = "‚öñÔ∏è";
                            if(cat.key === 'Possible Consideration') icon = "üëÄ";
                            
                            header.innerHTML = `${icon} &nbsp; ${cat.label}`;
                            section.appendChild(header);
                            
                            catItems.forEach(item => section.appendChild(createBillItem(item)));
                            scheduleList.appendChild(section);
                            
                            // Attach Observer for fade-in
                            observer.observe(section);
                        }
                    });
                }
            } else {
                scheduleList.innerHTML = '<div style="padding:60px; text-align:center; color:#94a3b8;">No Active Schedule Data Found.</div>';
            }
        } catch (e) { console.error(e); }
    }

    function createBillItem(item) {
        const div = document.createElement('div');
        div.className = 'bill-item';
        
        let linkHtml = '';
        if (item.link) {
            const isPdf = item.link.toLowerCase().endsWith('pdf');
            linkHtml = `<div class="bill-links"><a href="${item.link}" target="_blank" class="doc-link">${isPdf ? 'PDF' : 'TEXT'}</a></div>`;
        }
        
        let timeHtml = '';
        if (item.timestamp && item.timestamp.trim() !== "") {
            timeHtml = `<div class="bill-meta">Updated: <span class="meta-time">${item.timestamp}</span></div>`;
        }

        let fullTitle = item.title;
        let boldPart = fullTitle;
        let normalPart = "";

        let splitIndex = fullTitle.indexOf("‚Äî");
        if (splitIndex === -1) splitIndex = fullTitle.indexOf("-");

        if (splitIndex !== -1) {
            boldPart = fullTitle.substring(0, splitIndex).trim(); 
            normalPart = fullTitle.substring(splitIndex); 
        } else {
            // Fallback if no separator found
            boldPart = fullTitle;
        }

        div.innerHTML = `
            <div class="bill-row">
                <div class="bill-title"><strong>${boldPart}</strong> ${normalPart}</div>
                ${linkHtml}
            </div>
            ${timeHtml}
        `;
        return div;
    }
    
    initFeed();
    setInterval(initFeed, 10000);

    const btn = document.getElementById('submitBtn');
    const input = document.getElementById('email');
    const stat = document.getElementById('status');

    btn.addEventListener('click', async () => {
      const email = input.value.trim();
      
      if (!email.includes('@')) { 
          stat.textContent = "Please enter a valid work email."; 
          stat.style.color = "#f87171"; // Red
          return; 
      }

      btn.disabled = true; 
      btn.textContent = "Authenticating...";
      stat.textContent = "";

      const { error } = await _supabase.from('subscribers').insert([{ email: email }]);

      if (error) {
          if (error.code === '23505') {
              stat.textContent = "You are already in the system.";
              stat.style.color = "#60a5fa"; // Blue
          } else {
              stat.textContent = "Connection error. Please retry.";
              stat.style.color = "#f87171"; 
          }
          btn.disabled = false; 
          btn.textContent = "Subscribe for Free";
      } else {
          stat.textContent = "Confirmed. You are now tracking the floor.";
          stat.style.color = "#4ade80"; // Green
          input.value = "";
          btn.textContent = "Success";
          
          setTimeout(() => {
              btn.disabled = false;
              btn.textContent = "Subscribe Colleague";
              stat.textContent = "";
          }, 3000);
      }
    });
  </script>
</body>
</html>
